import random
import hashlib
import time  # Import the time module to access timestamps

def generate_hash(message):
    """Generate a hash of the original message using SHA-256."""
    hash_object = hashlib.sha256(message.encode())
    return hash_object.hexdigest()

def generate_space_replacement():
    """Return a unique character for space replacement."""
    # Using a special Unicode character for space replacement
    return '‚ê£'  # Using a special Unicode character

def encrypt(message):
    """Encrypt the message using a complex algorithm."""
    # Get the current timestamp
    timestamp = str(int(time.time()))  # Current time in seconds since epoch

    # Seed the random number generator with the current timestamp
    random.seed(timestamp)

    # Generate the hash for the original message
    hash_value = generate_hash(message)

    # Calculate a shift value based on the hash
    shift_value = sum(ord(c) for c in hash_value) % 26  # Shift based on the hash characters

    encrypted_message = ''

    for char in message:
        if char.isalpha():
            if char.islower():
                shift = (ord(char) - ord('a') + shift_value) % 26 + ord('a')
            else:
                shift = (ord(char) - ord('A') + shift_value) % 26 + ord('A')
            encrypted_message += chr(shift)
        elif char.isdigit():
            # Shift digits (0-9)
            shift = (ord(char) - ord('0') + shift_value) % 10 + ord('0')
            encrypted_message += chr(shift)
        elif char == ' ':
            encrypted_message += generate_space_replacement()  # Replace space with a unique character
        else:
            encrypted_message += char  # Leave other special characters unchanged

    return encrypted_message, hash_value  # Return the encrypted message and hash

def decrypt(encrypted_message, hash_value):
    """Decrypt the message by reversing the encryption process."""
    # Calculate the shift value based on the provided hash
    shift_value = sum(ord(c) for c in hash_value) % 26  # Same shift calculation as in encryption

    decrypted_message = ''

    for char in encrypted_message:
        if char.isalpha():
            if char.islower():
                shift = (ord(char) - ord('a') - shift_value) % 26 + ord('a')
            else:
                shift = (ord(char) - ord('A') - shift_value) % 26 + ord('A')
            decrypted_message += chr(shift)
        elif char.isdigit():
            # Reverse the digit shift during decryption
            shift = (ord(char) - ord('0') - shift_value) % 10 + ord('0')
            decrypted_message += chr(shift)
        elif char == generate_space_replacement():  # Check for our unique space character
            decrypted_message += ' '  # Convert the unique character back to space
        else:
            decrypted_message += char  # Leave other characters unchanged

    # Verify if the decrypted message's hash matches the original hash
    if generate_hash(decrypted_message) == hash_value:
        return decrypted_message  # Return the valid decrypted message
    else:
        return None  # Return None if no valid decryption was found

# Example usage
if __name__ == "__main__":
    action = input("Do you want to encrypt or decrypt a message? (e/d): ").strip().lower()

    if action == 'e':
        message = input("Enter a message to encrypt: ")
        encrypted_message, hash_value = encrypt(message)
        print("Encrypted message:", encrypted_message)
        print("Hash of the original message (store securely for decryption):", hash_value)

    elif action == 'd':
        encrypted_message = input("Enter the encrypted message: ")
        hash_value = input("Enter the hash of the original message: ")
        decrypted_message = decrypt(encrypted_message, hash_value)
        if decrypted_message:
            print("Decrypted message:", decrypted_message)
        else:
            print("Decryption failed! Invalid encrypted message or hash.")
